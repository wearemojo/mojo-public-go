{
	"bsonType": "object",
	"additionalProperties": false,

	"required": [
		"timestamp",
		"reason",
		"actor"
	],

	"properties": {
		"timestamp": {
			"bsonType": "date"
		},

		"reason": {
			"bsonType": "object",
			"additionalProperties": false,

			"required": [
				"code",
				"meta"
			],

			"properties": {
				"code": {
					"bsonType": "string",
					"minLength": 1
				},

				"meta": {
					"bsonType": ["object", "null"],
					"additionalProperties": true,
					"minProperties": 1
				}
			}
		},

		"actor": {
			"bsonType": "object",
			"additionalProperties": false,

			"required": [
				"type",
				"params"
			],

			"properties": {
				"type": { "bsonType": "string" },
				"params": { "bsonType": "object" }
			},

			"oneOf": [
				{
					"properties": {
						"type": { "enum": ["unknown"] },
						"params": { "enum": [{}] }
					}
				},
				{
					"properties": {
						"type": { "enum": ["internal"] },

						"params": {
							"additionalProperties": false,

							"required": [
								"revision",
								"code_path"
							],

							"properties": {
								"revision": {
									"bsonType": "string",
									"pattern": "^([\\da-f]{40}|dev)$"
								},
								"code_path": {
									"bsonType": "string",
									"minLength": 1
								}
							}
						}
					}
				},
				{
					"properties": {
						"type": { "enum": ["service"] },

						"params": {
							"additionalProperties": false,

							"required": [
								"env",
								"service"
							],

							"properties": {
								"env": {
									"bsonType": "string",
									"minLength": 1
								},
								"service": {
									"bsonType": "string",
									"minLength": 1
								}
							}
						}
					}
				},
				{
					"properties": {
						"type": { "enum": ["user"] },

						"params": {
							"additionalProperties": false,

							"required": [
								"user_id",
								"session_id"
							],

							"properties": {
								"user_id": {
									"bsonType": "string",
									"pattern": "user_"
								},

								"session_id": {
									"bsonType": ["string", "null"],
									"pattern": "session_"
								}
							}
						}
					}
				},
				{
					"properties": {
						"type": { "enum": ["session"] },

						"params": {
							"additionalProperties": false,

							"required": [
								"session_id"
							],

							"properties": {
								"session_id": {
									"bsonType": "string",
									"pattern": "session_"
								}
							}
						}
					}
				},
				{
					"properties": {
						"type": { "enum": ["external_cloud_auth"] },

						"params": {
							"additionalProperties": false,

							"required": [
								"type",
								"service"
							],

							"properties": {
								"type": {
									"bsonType": "string",
									"minLength": 1
								},

								"service": {
									"bsonType": "string",
									"minLength": 1
								}
							}
						}
					}
				}
			]
		}
	}
}
